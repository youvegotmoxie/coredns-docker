---
- name: "Configure DNS Server"
  gather_facts: yes
  hosts: all
  vars_files:
    - group_vars/all.yaml
  tasks:
    - assert:
        that:
        - "ansible_distribution == 'Ubuntu'"
        fail_msg: "This playbook contains apt specific tasks that will not work on non-Ubuntu systems"
    - import_tasks: tasks/docker-user.yaml
    - import_tasks: tasks/compose-docker.yaml
    - import_tasks: tasks/coredns.yaml
      when: optional_tasks.setup_compose is true
    - import_tasks: tasks/datadog.yaml
      when:
      - optional_tasks.setup_compose is true
      - optional_tasks.compose_file.containers.coredns.datadog.enabled is true
      tags:
      - datadog

  handlers:
  - name: "restart-docker"
    service:
      name: docker
      state: restarted
      enabled: yes
  - name: "restart-datadog"
    service:
      name: datadog-agent
      state: restarted
      enabled: yes
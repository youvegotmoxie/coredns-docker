{% for zone in dns['zones'] %}
{{ zone }}. {
  file /root/zones/{{ zone }}.zone {
    reload 10s
  }

  log {
    class all '{"host": "{remote}:{port}", "id": "{>id}", "record": "{type} {class} {name} {proto} {size} {>do} {>bufsize}", "response_code": "{rcode}", "response_flags": "{>rflags}", "response_size": "{rsize}", "response_time": "{duration}"}'
  }

  cache {
    success 5000
    denial 3000
  }

  errors {
    consolidate 5m ".* i/o timeout$" warning
    consolidate 30s "^Failed to .+"
  }
{% if optional_tasks.compose_file.containers.coredns.prometheus.enabled is true %}
  prometheus 0.0.0.0:9153
{% endif %}
}
{% endfor %}
